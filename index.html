<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="íƒ€ë¡œ108 â€” AIì™€ 30ë…„ ì‹¤ì „ê²½í—˜ì´ ë§Œë‚œ íƒ€ë¡œ ìƒë‹´">
<meta name="theme-color" content="#060410">

<!-- OG Tags for SNS Share -->
<meta property="og:title" content="íƒ€ë¡œ108 ğŸ”®">
<meta property="og:description" content="AIì™€ 30ë…„ ì‹¤ì „ê²½í—˜ì´ ë§Œë‚œ íƒ€ë¡œ ìƒë‹´ Â· ì§€ê¸ˆ ë°”ë¡œ ì¹´ë“œë¥¼ ë½‘ì•„ë³´ì„¸ìš”">
<meta property="og:type" content="website">

<title>íƒ€ë¡œ108 â€” AI íƒ€ë¡œ ìƒë‹´</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;600&family=Noto+Serif+KR:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #C9A84C;
    --gold-light: #F0D080;
    --gold-dim: #7A5F2A;
    --deep: #060410;
    --mid: #0D0920;
    --surface: #130E2A;
    --surface2: #1C1535;
    --purple: #6B3FA0;
    --purple-dim: #2D1A52;
    --text: #E8DFC8;
    --text-dim: #8A7F6A;
    --accent: #A855F7;
    --glow: rgba(201,168,76,0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Serif KR', serif;
    background: var(--deep);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse at 20% 30%, rgba(107,63,160,0.25) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 70%, rgba(168,85,247,0.15) 0%, transparent 50%),
      radial-gradient(ellipse at 50% 50%, rgba(201,168,76,0.05) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .stars { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

  .star {
    position: absolute;
    background: white;
    border-radius: 50%;
    animation: twinkle var(--d, 3s) ease-in-out infinite;
    animation-delay: var(--delay, 0s);
  }

  @keyframes twinkle {
    0%, 100% { opacity: 0.1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.5); }
  }

  .app {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    text-align: center;
    padding: 48px 20px 32px;
    border-bottom: 1px solid rgba(201,168,76,0.15);
    position: relative;
  }

  header::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }

  .logo-symbol {
    font-size: 32px;
    margin-bottom: 8px;
    animation: float 4s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }

  .logo-title {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(32px, 8vw, 62px);
    font-weight: 900;
    background: linear-gradient(135deg, var(--gold-dim), var(--gold-light), var(--gold));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 0.2em;
    filter: drop-shadow(0 0 20px rgba(201,168,76,0.4));
  }

  .logo-num {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(20px, 4vw, 36px);
    font-weight: 400;
    background: linear-gradient(135deg, var(--accent), var(--gold-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 0.1em;
    margin-left: 4px;
  }

  .logo-sub {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 0.5em;
    color: var(--text-dim);
    margin-top: 6px;
    text-transform: uppercase;
  }

  .expert-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 16px;
    padding: 6px 16px;
    border: 1px solid rgba(201,168,76,0.3);
    border-radius: 20px;
    background: rgba(201,168,76,0.05);
    font-size: 12px;
    color: var(--gold);
    letter-spacing: 0.1em;
  }

  /* â”€â”€ LAYOUT â”€â”€ */
  main {
    flex: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 40px 20px;
    width: 100%;
  }

  .screen { display: none; }
  .screen.active { display: block; }

  /* â”€â”€ NAV TABS â”€â”€ */
  .nav-tabs {
    display: flex;
    justify-content: center;
    gap: 4px;
    margin-bottom: 40px;
    background: var(--surface);
    padding: 6px;
    border-radius: 12px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  .nav-tab {
    flex: 1;
    padding: 10px 16px;
    background: transparent;
    border: none;
    border-radius: 8px;
    color: var(--text-dim);
    font-family: 'Cinzel', serif;
    font-size: 12px;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all 0.2s;
  }

  .nav-tab.active {
    background: linear-gradient(135deg, var(--gold-dim), var(--gold));
    color: var(--deep);
    font-weight: 700;
  }

  /* â”€â”€ WELCOME â”€â”€ */
  .welcome-section {
    text-align: center;
    margin-bottom: 48px;
  }

  .welcome-section h2 {
    font-family: 'Cinzel', serif;
    font-size: clamp(18px, 3vw, 26px);
    color: var(--gold-light);
    margin-bottom: 12px;
  }

  .welcome-section p {
    color: var(--text-dim);
    font-size: 15px;
    line-height: 1.8;
    max-width: 500px;
    margin: 0 auto;
  }

  /* â”€â”€ SPREAD GRID â”€â”€ */
  .spread-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    margin-bottom: 40px;
  }

  .spread-card {
    background: var(--surface);
    border: 1px solid rgba(201,168,76,0.15);
    border-radius: 12px;
    padding: 24px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .spread-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(201,168,76,0.08), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }

  .spread-card:hover::before,
  .spread-card.selected::before { opacity: 1; }

  .spread-card:hover,
  .spread-card.selected {
    border-color: var(--gold);
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(201,168,76,0.15);
  }

  .spread-card.selected { border-color: var(--gold-light); box-shadow: 0 0 20px rgba(201,168,76,0.25); }

  .spread-icon { font-size: 32px; margin-bottom: 12px; }
  .spread-name { font-family: 'Cinzel', serif; font-size: 14px; color: var(--gold); margin-bottom: 6px; letter-spacing: 0.05em; }
  .spread-desc { font-size: 12px; color: var(--text-dim); line-height: 1.5; }

  /* â”€â”€ QUESTION â”€â”€ */
  .question-section {
    background: var(--surface);
    border: 1px solid rgba(201,168,76,0.15);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 32px;
  }

  .question-section h3 {
    font-family: 'Cinzel', serif;
    font-size: 16px;
    color: var(--gold);
    margin-bottom: 16px;
    letter-spacing: 0.1em;
  }

  .emotion-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }

  .chip {
    padding: 6px 14px;
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 20px;
    font-size: 12px;
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.2s;
    background: transparent;
    font-family: 'Noto Serif KR', serif;
  }

  .chip:hover, .chip.active {
    border-color: var(--gold);
    color: var(--gold);
    background: rgba(201,168,76,0.08);
  }

  textarea {
    width: 100%;
    background: var(--mid);
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 10px;
    padding: 16px;
    color: var(--text);
    font-family: 'Noto Serif KR', serif;
    font-size: 15px;
    line-height: 1.7;
    resize: none;
    height: 120px;
    transition: border-color 0.3s;
    outline: none;
  }

  textarea:focus { border-color: var(--gold); box-shadow: 0 0 15px rgba(201,168,76,0.1); }
  textarea::placeholder { color: var(--text-dim); }

  /* â”€â”€ API KEY INPUT â”€â”€ */
  .api-key-section {
    background: var(--surface2);
    border: 1px solid rgba(168,85,247,0.2);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 24px;
  }

  .api-key-section h3 {
    font-family: 'Cinzel', serif;
    font-size: 13px;
    color: var(--accent);
    letter-spacing: 0.1em;
    margin-bottom: 10px;
  }

  .api-key-row { display: flex; gap: 8px; align-items: center; }

  .api-key-row input {
    flex: 1;
    background: var(--mid);
    border: 1px solid rgba(168,85,247,0.3);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-size: 13px;
    outline: none;
    font-family: monospace;
    transition: border-color 0.2s;
  }

  .api-key-row input:focus { border-color: var(--accent); }

  .api-key-note {
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 8px;
    line-height: 1.5;
  }

  .api-key-note a { color: var(--accent); text-decoration: none; }
  .api-key-note a:hover { text-decoration: underline; }

  /* â”€â”€ BUTTONS â”€â”€ */
  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 14px 36px;
    background: linear-gradient(135deg, var(--gold-dim), var(--gold));
    color: var(--deep);
    border: none;
    border-radius: 8px;
    font-family: 'Cinzel', serif;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
  }

  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 25px rgba(201,168,76,0.35);
    background: linear-gradient(135deg, var(--gold), var(--gold-light));
  }

  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

  .btn-secondary {
    padding: 10px 24px;
    background: transparent;
    border: 1px solid rgba(201,168,76,0.3);
    border-radius: 8px;
    color: var(--gold);
    font-family: 'Cinzel', serif;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-secondary:hover { background: rgba(201,168,76,0.08); border-color: var(--gold); }

  .btn-save-key {
    padding: 10px 16px;
    background: rgba(168,85,247,0.15);
    border: 1px solid rgba(168,85,247,0.4);
    border-radius: 8px;
    color: var(--accent);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    font-family: 'Noto Serif KR', serif;
  }

  .btn-save-key:hover { background: rgba(168,85,247,0.25); }

  /* â”€â”€ CARDS STAGE â”€â”€ */
  .cards-stage { text-align: center; margin-bottom: 48px; }
  .cards-stage h2 { font-family: 'Cinzel', serif; font-size: 20px; color: var(--gold-light); margin-bottom: 8px; }
  .cards-stage p { color: var(--text-dim); font-size: 14px; margin-bottom: 20px; }

  .card-deck {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 32px;
  }

  .tarot-slot { width: 120px; text-align: center; }
  .slot-label { font-family: 'Cinzel', serif; font-size: 11px; letter-spacing: 0.15em; color: var(--text-dim); margin-bottom: 12px; text-transform: uppercase; }

  .tarot-card {
    width: 120px;
    height: 200px;
    border-radius: 10px;
    border: 2px solid rgba(201,168,76,0.3);
    background: var(--surface);
    cursor: pointer;
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
  }

  .tarot-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(201,168,76,0.04) 4px, rgba(201,168,76,0.04) 5px);
  }

  .tarot-card.face-down { background: linear-gradient(135deg, #1C1535, #0D0920); }
  .tarot-card.face-down:hover {
    border-color: var(--gold);
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 20px 40px rgba(201,168,76,0.2), 0 0 30px rgba(168,85,247,0.15);
  }

  .tarot-card.flipping { animation: cardFlip 0.6s ease forwards; }

  @keyframes cardFlip {
    0% { transform: rotateY(0) translateY(-8px); }
    50% { transform: rotateY(90deg) scale(1.1); }
    100% { transform: rotateY(0) translateY(0); }
  }

  .tarot-card.revealed {
    cursor: default;
    background: linear-gradient(135deg, var(--surface2), var(--surface));
    border-color: var(--gold);
    box-shadow: 0 0 25px rgba(201,168,76,0.2);
    flex-direction: column;
    gap: 6px;
  }

  .tarot-card.reversed { transform: rotate(180deg); }
  .tarot-card.revealed.reversed { transform: rotate(180deg); border-color: rgba(168,85,247,0.7); }
  .card-emoji { font-size: 36px; }
  .card-name-small { font-family: 'Cinzel', serif; font-size: 9px; color: var(--gold); text-align: center; padding: 0 8px; letter-spacing: 0.05em; line-height: 1.3; }
  .card-rev-badge { font-size: 9px; color: rgba(168,85,247,0.9); letter-spacing: 0.05em; }
  .cards-hint { font-size: 13px; color: var(--text-dim); font-style: italic; margin-bottom: 20px; }

  /* â”€â”€ LOADING â”€â”€ */
  .loading-overlay {
    position: fixed;
    inset: 0;
    background: rgba(6,4,16,0.92);
    z-index: 100;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 24px;
    backdrop-filter: blur(10px);
  }

  .loading-symbol { font-size: 60px; animation: spin-glow 3s linear infinite; }

  @keyframes spin-glow {
    0% { transform: rotate(0deg); filter: drop-shadow(0 0 10px var(--gold)); }
    50% { transform: rotate(180deg); filter: drop-shadow(0 0 25px var(--accent)); }
    100% { transform: rotate(360deg); filter: drop-shadow(0 0 10px var(--gold)); }
  }

  .loading-text { font-family: 'Cinzel', serif; font-size: 16px; color: var(--gold); letter-spacing: 0.2em; animation: pulse-text 1.5s ease-in-out infinite; }

  @keyframes pulse-text { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

  .loading-dots span {
    display: inline-block;
    width: 8px;
    height: 8px;
    background: var(--gold);
    border-radius: 50%;
    margin: 0 4px;
    animation: dot-bounce 1.2s ease-in-out infinite;
  }

  .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
  .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes dot-bounce { 0%, 80%, 100% { transform: translateY(0); opacity: 0.3; } 40% { transform: translateY(-10px); opacity: 1; } }

  /* â”€â”€ RESULT â”€â”€ */
  .result-header { text-align: center; margin-bottom: 40px; }
  .result-header h2 { font-family: 'Cinzel Decorative', serif; font-size: clamp(20px, 4vw, 32px); color: var(--gold-light); margin-bottom: 8px; filter: drop-shadow(0 0 10px rgba(201,168,76,0.4)); }

  .divider { width: 200px; height: 1px; background: linear-gradient(90deg, transparent, var(--gold), transparent); margin: 16px auto; }
  .ornament { text-align: center; font-size: 20px; color: var(--gold-dim); margin: 8px 0; letter-spacing: 0.3em; }

  .drawn-cards-summary { display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; margin-bottom: 36px; }

  .summary-card { text-align: center; padding: 16px; background: var(--surface); border: 1px solid rgba(201,168,76,0.2); border-radius: 10px; min-width: 100px; }
  .summary-card-emoji { font-size: 28px; margin-bottom: 6px; }
  .summary-card-label { font-family: 'Cinzel', serif; font-size: 9px; color: var(--text-dim); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 4px; }
  .summary-card-name { font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold); }
  .summary-card-rev { font-size: 10px; color: rgba(168,85,247,0.8); margin-top: 2px; }

  .reading-section {
    background: var(--surface);
    border: 1px solid rgba(201,168,76,0.15);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }

  .reading-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--gold), transparent); }

  .reading-section h3 { font-family: 'Cinzel', serif; font-size: 14px; color: var(--gold); letter-spacing: 0.2em; text-transform: uppercase; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }

  .reading-text { font-size: 15px; line-height: 2; color: var(--text); white-space: pre-wrap; }

  .advice-box { margin-top: 24px; padding: 20px; background: linear-gradient(135deg, rgba(201,168,76,0.08), rgba(107,63,160,0.08)); border: 1px solid rgba(201,168,76,0.25); border-radius: 10px; }
  .advice-box h4 { font-family: 'Cinzel', serif; font-size: 12px; color: var(--gold-light); letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 10px; }
  .advice-text { font-size: 14px; color: var(--text); line-height: 1.8; }

  .expert-note { display: flex; align-items: flex-start; gap: 16px; padding: 20px; background: var(--surface2); border-radius: 10px; margin-top: 16px; border-left: 3px solid var(--gold); }
  .expert-avatar { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, var(--gold-dim), var(--purple)); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
  .expert-note-text { font-size: 13px; color: var(--text-dim); line-height: 1.7; font-style: italic; }
  .expert-name { font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold); letter-spacing: 0.1em; margin-bottom: 4px; }

  /* â”€â”€ HISTORY â”€â”€ */
  .history-item { background: var(--surface); border: 1px solid rgba(201,168,76,0.1); border-radius: 10px; padding: 16px 20px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 16px; }
  .history-item:hover { border-color: rgba(201,168,76,0.3); background: var(--surface2); }
  .history-date { font-family: 'Cinzel', serif; font-size: 11px; color: var(--text-dim); white-space: nowrap; }
  .history-question { font-size: 14px; color: var(--text); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .history-cards { font-size: 20px; white-space: nowrap; }

  .empty-state { text-align: center; padding: 60px 20px; color: var(--text-dim); }
  .empty-state .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.4; }
  .empty-state p { font-size: 14px; line-height: 1.7; }

  .action-row { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-top: 32px; padding-top: 24px; border-top: 1px solid rgba(201,168,76,0.1); }

  .fade-in { animation: fadeInUp 0.6s ease forwards; opacity: 0; }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .fade-in-delay-1 { animation-delay: 0.1s; }
  .fade-in-delay-2 { animation-delay: 0.2s; }
  .fade-in-delay-3 { animation-delay: 0.3s; }

  /* â”€â”€ 108 TOOLTIP â”€â”€ */
  .num108-tooltip {
    display: inline-block;
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 4px;
    letter-spacing: 0.05em;
    cursor: help;
  }

  @media (max-width: 600px) {
    .spread-grid { grid-template-columns: 1fr 1fr; }
    .card-deck { gap: 12px; }
    .tarot-card, .tarot-slot { width: 90px; }
    .tarot-card { height: 150px; }
    .reading-section { padding: 20px; }
    .api-key-row { flex-direction: column; }
    .btn-save-key { width: 100%; }
  }
</style>
</head>
<body>

<div class="stars" id="starsContainer"></div>

<div class="app">
  <header>
    <div class="logo-symbol">ğŸ”®</div>
    <div>
      <span class="logo-title">íƒ€ë¡œ</span><span class="logo-num">108</span>
    </div>
    <div class="logo-sub">AI Â· íƒ€ë¡œ ìƒë‹´ Â· 30ë…„ ì‹¤ì „ê²½í—˜</div>
    <div class="expert-badge">âœ¦ 108ê°€ì§€ ì¸ìƒ ì§ˆë¬¸, íƒ€ë¡œê°€ ë‹µí•©ë‹ˆë‹¤ âœ¦</div>
    <div class="num108-tooltip">* 108ì€ ë¶ˆêµì˜ ë²ˆë‡Œ ìˆ˜ì´ì íƒ€ë¡œì˜ ìš°ì£¼ì  ìˆ«ìì…ë‹ˆë‹¤</div>
  </header>

  <main>
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="showTab('consult', this)">ğŸ”® ìƒë‹´</button>
      <button class="nav-tab" onclick="showTab('history', this)">ğŸ“œ íˆìŠ¤í† ë¦¬</button>
    </div>

    <!-- â•â•â• CONSULT SCREEN â•â•â• -->
    <div id="screen-consult" class="screen active">

      <!-- STEP 1 -->
      <div id="step-1">
        <div class="welcome-section fade-in">
          <h2>ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ì§ˆë¬¸ì€ ë¬´ì—‡ì¸ê°€ìš”?</h2>
          <p>AIì™€ 30ë…„ ì‹¤ì „ íƒ€ë¡œ ì „ë¬¸ê°€ì˜ ì§€í˜œê°€<br>ë‹¹ì‹ ì˜ ì§ˆë¬¸ì— ê¹Šì´ ìˆê²Œ ë‹µí•©ë‹ˆë‹¤</p>
        </div>

        <!-- API Key -->
        <div class="api-key-section fade-in">
          <h3>âš™ CLAUDE API KEY ì„¤ì •</h3>
          <div class="api-key-row">
            <input type="password" id="apiKeyInput" placeholder="sk-ant-api03-..." value="">
            <button class="btn-save-key" onclick="saveApiKey()">ì €ì¥</button>
          </div>
          <div class="api-key-note">
            API KeyëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
            í‚¤ê°€ ì—†ìœ¼ë©´ <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a>ì—ì„œ ë°œê¸‰í•˜ì„¸ìš”.
            ì…ë ¥ ì—†ì´ë„ ë°ëª¨ ë¦¬ë”©ì„ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>

        <!-- Spread Selection -->
        <div class="spread-grid fade-in fade-in-delay-1">
          <div class="spread-card selected" data-spread="3" onclick="selectSpread(this, 3)">
            <div class="spread-icon">ğŸƒğŸƒğŸƒ</div>
            <div class="spread-name">3ì¥ ë°°ì—´</div>
            <div class="spread-desc">ê³¼ê±° Â· í˜„ì¬ Â· ë¯¸ë˜ì˜<br>íë¦„ì„ ì½ìŠµë‹ˆë‹¤</div>
          </div>
          <div class="spread-card" data-spread="1" onclick="selectSpread(this, 1)">
            <div class="spread-icon">ğŸƒ</div>
            <div class="spread-name">ì›ì¹´ë“œ</div>
            <div class="spread-desc">í•µì‹¬ ë©”ì‹œì§€<br>í•œ ì¥ì˜ ì§„ì‹¤</div>
          </div>
          <div class="spread-card" data-spread="5" onclick="selectSpread(this, 5)">
            <div class="spread-icon">âœ¦ğŸƒâœ¦</div>
            <div class="spread-name">ì¼ˆí‹± í¬ë¡œìŠ¤</div>
            <div class="spread-desc">ê¹Šì€ ìƒí™© ë¶„ì„<br>5ì¥ ì‹¬ì¸µ ë¦¬ë”©</div>
          </div>
        </div>

        <!-- Question -->
        <div class="question-section fade-in fade-in-delay-2">
          <h3>âœ¦ ê°ì • ìƒíƒœ ì„ íƒ</h3>
          <div class="emotion-chips">
            <button class="chip" onclick="toggleChip(this)">ğŸ’­ ê³ ë¯¼ ì¤‘</button>
            <button class="chip" onclick="toggleChip(this)">ğŸ˜Ÿ ë¶ˆì•ˆí•¨</button>
            <button class="chip" onclick="toggleChip(this)">ğŸ’” ì´ë³„</button>
            <button class="chip" onclick="toggleChip(this)">ğŸ’¼ ì§ì—…/ì§„ë¡œ</button>
            <button class="chip" onclick="toggleChip(this)">ğŸ’• ì—°ì• </button>
            <button class="chip" onclick="toggleChip(this)">ğŸ’° ê¸ˆì „</button>
            <button class="chip" onclick="toggleChip(this)">ğŸ  ê°€ì¡±</button>
            <button class="chip" onclick="toggleChip(this)">ğŸŒ± ì„±ì¥</button>
          </div>
          <h3>âœ¦ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</h3>
          <textarea id="questionInput" placeholder="ì˜ˆ: í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ê°€ ì„±ê³µí•  ìˆ˜ ìˆì„ê¹Œìš”? ì§€ê¸ˆ ì‚¬ê·€ê³  ì‹¶ì€ ì‚¬ëŒì´ ìˆëŠ”ë° ì´ ì¸ì—°ì´ ì´ì–´ì§ˆê¹Œìš”?"></textarea>
        </div>

        <div style="text-align:center" class="fade-in fade-in-delay-3">
          <button class="btn-primary" onclick="startDrawing()">
            âœ¦ ì¹´ë“œë¥¼ í¼ì³ì£¼ì„¸ìš” âœ¦
          </button>
        </div>
      </div>

      <!-- STEP 2 -->
      <div id="step-2" style="display:none">
        <div class="cards-stage">
          <h2>âœ¦ ë§ˆìŒì´ ì´ë„ëŠ” ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
          <p>ì§ê°ì„ ë¯¿ê³ , ë‹¹ì‹ ì„ ë¶€ë¥´ëŠ” ì¹´ë“œë¥¼ í´ë¦­í•˜ì„¸ìš”</p>
          <p id="cardsHint" class="cards-hint"></p>
          <div class="card-deck" id="cardDeck"></div>
          <div id="drawCompleteArea" style="display:none; margin-top:20px;">
            <button class="btn-primary" onclick="getReading()">âœ¦ ì „ë¬¸ê°€ AI ë¦¬ë”© ì‹œì‘ âœ¦</button>
          </div>
        </div>
      </div>

      <!-- STEP 3 -->
      <div id="step-3" style="display:none">
        <div class="result-header fade-in">
          <h2>âœ¦ íƒ€ë¡œ108ì´ ë§í•˜ëŠ” ë‹¹ì‹ ì˜ ì´ì•¼ê¸°</h2>
          <div class="divider"></div>
          <div class="ornament">âŸ¡ âœ¦ âŸ¡</div>
        </div>
        <div id="drawnCardsSummary" class="drawn-cards-summary fade-in"></div>
        <div id="readingContent"></div>
        <div class="action-row">
          <button class="btn-secondary" onclick="restartReading()">ğŸ”® ìƒˆë¡œìš´ ìƒë‹´</button>
          <button class="btn-secondary" onclick="shareReading()">ğŸ“¤ ê²°ê³¼ ì €ì¥</button>
        </div>
      </div>

    </div>

    <!-- â•â•â• HISTORY SCREEN â•â•â• -->
    <div id="screen-history" class="screen">
      <div id="historyList"></div>
    </div>

  </main>
</div>

<!-- Loading -->
<div id="loadingOverlay" class="loading-overlay" style="display:none">
  <div class="loading-symbol">âŸ¡</div>
  <div class="loading-text">íƒ€ë¡œ108ì´ ë‹¹ì‹ ì˜ ì—ë„ˆì§€ë¥¼ ì½ëŠ” ì¤‘...</div>
  <div class="loading-dots"><span></span><span></span><span></span></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  íƒ€ë¡œ108 â€” App Logic
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const TAROT_DECK = [
  { name:"ë°”ë³´", emoji:"ğŸƒ", keywords:"ìƒˆë¡œìš´ ì‹œì‘, ììœ ë¡œìš´ ì˜í˜¼, ëª¨í—˜" },
  { name:"ë§ˆë²•ì‚¬", emoji:"ğŸ©", keywords:"ì˜ì§€ë ¥, ì°½ì¡°, ëŠ¥ìˆ™í•¨" },
  { name:"ì—¬ì‚¬ì œ", emoji:"ğŸŒ™", keywords:"ì§ê´€, ì‹ ë¹„, ë‚´ë©´ì˜ ì§€í˜œ" },
  { name:"ì—¬í™©ì œ", emoji:"ğŸ‘¸", keywords:"í’ìš”, ì°½ì¡°ì  ì—ë„ˆì§€, ëª¨ì„±" },
  { name:"í™©ì œ", emoji:"ğŸ‘‘", keywords:"ê¶Œìœ„, ì•ˆì •, ë¦¬ë”ì‹­" },
  { name:"êµí™©", emoji:"â›ª", keywords:"ì „í†µ, ì§€í˜œ, ì˜ì  ì•ˆë‚´" },
  { name:"ì—°ì¸", emoji:"ğŸ’•", keywords:"ì‚¬ë‘, ì„ íƒ, ì¡°í™”" },
  { name:"ì „ì°¨", emoji:"ğŸ†", keywords:"ìŠ¹ë¦¬, ì˜ì§€, ëŒíŒŒêµ¬" },
  { name:"í˜", emoji:"ğŸ¦", keywords:"ìš©ê¸°, ì¸ë‚´, ë‚´ë©´ì˜ í˜" },
  { name:"ì€ë‘”ì", emoji:"ğŸ•¯ï¸", keywords:"ì„±ì°°, ê³ ë…, ë‚´ë©´ íƒêµ¬" },
  { name:"ìš´ëª…ì˜ ë°”í€´", emoji:"ğŸ¡", keywords:"ë³€í™”, ìš´ëª…, ìˆœí™˜" },
  { name:"ì •ì˜", emoji:"âš–ï¸", keywords:"ê· í˜•, ì§„ì‹¤, ê³µì •í•¨" },
  { name:"ë§¤ë‹¬ë¦° ì‚¬ëŒ", emoji:"ğŸ™ƒ", keywords:"í¬ìƒ, ê´€ì  ì „í™˜, ê¸°ë‹¤ë¦¼" },
  { name:"ì£½ìŒ", emoji:"ğŸŒ‘", keywords:"ë³€í™”, ì „í™˜, ìƒˆë¡œìš´ ì‹œì‘" },
  { name:"ì ˆì œ", emoji:"ğŸŒŠ", keywords:"ê· í˜•, ì¸ë‚´, ì¤‘ìš©" },
  { name:"ì•…ë§ˆ", emoji:"ğŸ”—", keywords:"ì†ë°•, ìš•ë§, ë¬¼ì§ˆì£¼ì˜" },
  { name:"íƒ‘", emoji:"âš¡", keywords:"ê°‘ì‘ìŠ¤ëŸ¬ìš´ ë³€í™”, ê°ì„±" },
  { name:"ë³„", emoji:"â­", keywords:"í¬ë§, ì˜ê°, ì¹˜ìœ " },
  { name:"ë‹¬", emoji:"ğŸŒ•", keywords:"í™˜ìƒ, ë¶ˆí™•ì‹¤ì„±, ë¬´ì˜ì‹" },
  { name:"íƒœì–‘", emoji:"â˜€ï¸", keywords:"ì„±ê³µ, ê¸°ì¨, í™œë ¥" },
  { name:"ì‹¬íŒ", emoji:"ğŸ“¯", keywords:"ë¶€í™œ, ìê°, êµ¬ì›" },
  { name:"ì„¸ê³„", emoji:"ğŸŒ", keywords:"ì™„ì„±, ì„±ì·¨, í†µí•©" },
  { name:"ì™„ë“œ ì—ì´ìŠ¤", emoji:"ğŸ”¥", keywords:"ì°½ì¡°ì  ì—ë„ˆì§€, ì—´ì •" },
  { name:"ì»µ ì—ì´ìŠ¤", emoji:"ğŸ«™", keywords:"ê°ì •ì˜ ì‹œì‘, ì‚¬ë‘, ì§ê´€" },
  { name:"ê²€ ì—ì´ìŠ¤", emoji:"âš”ï¸", keywords:"ì§„ì‹¤, ëª…í™•í•¨, ê²°ë‹¨" },
  { name:"íœíƒ€í´ ì—ì´ìŠ¤", emoji:"ğŸª™", keywords:"ë¬¼ì§ˆì  ì‹œì‘, ë²ˆì˜" },
  { name:"ë³„ë¹› ìš”ì •", emoji:"âœ¨", keywords:"ë§ˆë²•, ì¶•ë³µ, ê¸°ì " },
  { name:"ë‹¬ë¹› ì—¬ì‹ ", emoji:"ğŸŒ›", keywords:"ì‹ ë¹„, ì—¬ì„±ì„±, ìˆœí™˜" },
  { name:"ë¶ˆê½ƒ ê¸°ì‚¬", emoji:"ğŸ‡", keywords:"ì—´ì •, í–‰ë™, ìš©ê°í•¨" },
  { name:"ìˆ˜í˜¸ ì²œì‚¬", emoji:"ğŸ‘¼", keywords:"ë³´í˜¸, ì¹˜ìœ , ì‹ ì„±í•œ ì•ˆë‚´" }
];

const POSITION_LABELS = {
  1: ["í•µì‹¬ ë©”ì‹œì§€"],
  3: ["ê³¼ê±°", "í˜„ì¬", "ë¯¸ë˜"],
  5: ["í˜„ì¬ ìƒí™©", "ì¥ì• ë¬¼", "ì ì¬ë ¥", "ì¡°ì–¸", "ê²°ê³¼"]
};

let selectedSpread = 3;
let drawnCards = [];
let currentQuestion = "";
let selectedEmotion = "";
let history = [];

try { history = JSON.parse(localStorage.getItem("taro108_history") || "[]"); } catch(e) {}

// Load saved API key
window.addEventListener('DOMContentLoaded', () => {
  const saved = localStorage.getItem("taro108_apikey");
  if (saved) document.getElementById("apiKeyInput").value = saved;
  createStars();
});

// â”€â”€ Stars
function createStars() {
  const c = document.getElementById("starsContainer");
  for (let i = 0; i < 130; i++) {
    const s = document.createElement("div");
    s.className = "star";
    const sz = Math.random() * 2 + 0.5;
    s.style.cssText = `width:${sz}px;height:${sz}px;left:${Math.random()*100}%;top:${Math.random()*100}%;--d:${2+Math.random()*4}s;--delay:${Math.random()*4}s;`;
    c.appendChild(s);
  }
}

// â”€â”€ API Key
function saveApiKey() {
  const val = document.getElementById("apiKeyInput").value.trim();
  if (val) {
    localStorage.setItem("taro108_apikey", val);
    alert("âœ… API Keyê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
  } else {
    localStorage.removeItem("taro108_apikey");
    alert("API Keyê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë°ëª¨ ëª¨ë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.");
  }
}

function getApiKey() {
  return document.getElementById("apiKeyInput").value.trim() || localStorage.getItem("taro108_apikey") || "";
}

// â”€â”€ Tabs
function showTab(tab, el) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".nav-tab").forEach(t => t.classList.remove("active"));
  document.getElementById("screen-" + tab).classList.add("active");
  if (el) el.classList.add("active");
  if (tab === "history") renderHistory();
}

// â”€â”€ Spread
function selectSpread(el, count) {
  document.querySelectorAll(".spread-card").forEach(c => c.classList.remove("selected"));
  el.classList.add("selected");
  selectedSpread = count;
}

function toggleChip(el) {
  el.classList.toggle("active");
  selectedEmotion = [...document.querySelectorAll(".chip.active")].map(c => c.textContent).join(", ");
}

// â”€â”€ Drawing
function startDrawing() {
  const q = document.getElementById("questionInput").value.trim();
  if (!q) {
    document.getElementById("questionInput").focus();
    document.getElementById("questionInput").style.borderColor = "var(--gold-light)";
    return;
  }
  currentQuestion = q;
  drawnCards = [];
  document.getElementById("step-1").style.display = "none";
  document.getElementById("step-2").style.display = "block";
  buildCardDeck();
  updateHint();
}

function buildCardDeck() {
  const deck = document.getElementById("cardDeck");
  deck.innerHTML = "";
  const labels = POSITION_LABELS[selectedSpread];
  const shuffled = [...TAROT_DECK].sort(() => Math.random() - 0.5);
  for (let i = 0; i < selectedSpread; i++) {
    const slot = document.createElement("div");
    slot.className = "tarot-slot";
    const label = document.createElement("div");
    label.className = "slot-label";
    label.textContent = labels[i];
    slot.appendChild(label);
    const card = document.createElement("div");
    card.className = "tarot-card face-down";
    card.innerHTML = "âœ¦";
    card.dataset.index = i;
    card.dataset.cardData = JSON.stringify(shuffled[i]);
    card.onclick = function() { drawCard(this, i); };
    slot.appendChild(card);
    deck.appendChild(slot);
  }
}

function drawCard(el, index) {
  if (el.classList.contains("revealed") || el.classList.contains("flipping")) return;
  const cardData = JSON.parse(el.dataset.cardData);
  const isReversed = Math.random() < 0.35;
  el.classList.add("flipping");
  setTimeout(() => {
    el.classList.remove("face-down","flipping");
    el.classList.add("revealed");
    if (isReversed) el.classList.add("reversed");
    el.innerHTML = `<div class="card-emoji">${cardData.emoji}</div><div class="card-name-small">${cardData.name}</div>${isReversed ? '<div class="card-rev-badge">ì—­ë°©í–¥</div>' : ''}`;
    el.onclick = null;
    drawnCards[index] = { ...cardData, reversed: isReversed, position: POSITION_LABELS[selectedSpread][index] };
    updateHint();
    if (drawnCards.filter(Boolean).length === selectedSpread) {
      document.getElementById("drawCompleteArea").style.display = "block";
    }
  }, 300);
}

function updateHint() {
  const remaining = selectedSpread - drawnCards.filter(Boolean).length;
  document.getElementById("cardsHint").textContent = remaining > 0
    ? `${remaining}ì¥ì˜ ì¹´ë“œê°€ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤`
    : "âœ¦ ëª¨ë“  ì¹´ë“œê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ë¦¬ë”©ì„ ì‹œì‘í•˜ì„¸ìš”!";
}

// â”€â”€ AI Reading
async function getReading() {
  document.getElementById("drawCompleteArea").style.display = "none";
  document.getElementById("loadingOverlay").style.display = "flex";

  const labels = POSITION_LABELS[selectedSpread];
  const cardsSummary = drawnCards.map((c, i) =>
    `${labels[i]}: ${c.name} (${c.reversed ? "ì—­ë°©í–¥" : "ì •ë°©í–¥"}) - í‚¤ì›Œë“œ: ${c.keywords}`
  ).join("\n");

  const systemPrompt = `ë‹¹ì‹ ì€ íƒ€ë¡œ108ì˜ AI íƒ€ë¡œ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤. 30ë…„ ê²½ë ¥ì˜ ì‹¤ì „ íƒ€ë¡œ ì „ë¬¸ê°€ì˜ ì§€ì‹ì´ ë‹¹ì‹ ì—ê²Œ ê¹ƒë“¤ì–´ ìˆìŠµë‹ˆë‹¤.

ë¦¬ë”© ì›ì¹™:
- ì¹´ë“œë¥¼ ë‹¨ìˆœ ë‚˜ì—´í•˜ì§€ ì•Šê³ , ì§ˆë¬¸ìì˜ ìƒí™©ê³¼ ê°ì •ì„ í†µí•©ì ìœ¼ë¡œ í•´ì„
- ì‹¬ë¦¬ì  í†µì°°ì„ ë‹´ì•„ "ì™œ ì´ ì¹´ë“œê°€ ë‚˜ì™”ëŠ”ì§€" ì„¤ëª…
- ëª¨í˜¸í•˜ê±°ë‚˜ ë‘ë£¨ë­‰ìˆ í•œ í‘œí˜„ ì ˆëŒ€ ê¸ˆì§€ â€” êµ¬ì²´ì ì´ê³  ì§ì ‘ì ìœ¼ë¡œ
- ë”°ëœ»í•˜ë˜ í˜„ì‹¤ì ì¸ ì–´íˆ¬ (ì¹œê·¼í•œ ì¡´ëŒ“ë§)
- ë§ˆì§€ë§‰ì— [ì¡°ì–¸] ì„¹ì…˜ìœ¼ë¡œ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ í–‰ë™ ì¡°ì–¸ 1ê°€ì§€ ì œì‹œ

ì¶œë ¥ êµ¬ì¡° (ë§ˆí¬ë‹¤ìš´ ì—†ì´ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ):
1. ì „ì²´ ì—ë„ˆì§€ íë¦„ í•´ì„ (2~3ë¬¸ë‹¨)
2. í¬ì§€ì…˜ë³„ ì¹´ë“œ í•´ì„ (ê° 2~3ì¤„)
3. [ì¡°ì–¸] ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ í–‰ë™ 1ê°€ì§€`;

  const userMsg = `ì§ˆë¬¸: ${currentQuestion}
ê°ì • ìƒíƒœ: ${selectedEmotion || "ë¯¸ì…ë ¥"}
ë°°ì—´: ${selectedSpread}ì¥ ìŠ¤í”„ë ˆë“œ

ë½‘íŒ ì¹´ë“œ:
${cardsSummary}

ìœ„ ì¹´ë“œë“¤ì„ ë°”íƒ•ìœ¼ë¡œ íƒ€ë¡œ108ì˜ ê¹Šì´ ìˆëŠ” ë¦¬ë”©ì„ í•´ì£¼ì„¸ìš”.`;

  const apiKey = getApiKey();

  try {
    if (!apiKey) throw new Error("no key");

    const res = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": apiKey,
        "anthropic-version": "2023-06-01",
        "anthropic-dangerous-direct-browser-access": "true"
      },
      body: JSON.stringify({
        model: "claude-opus-4-6",
        max_tokens: 1200,
        system: systemPrompt,
        messages: [{ role: "user", content: userMsg }]
      })
    });

    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    const text = data.content?.[0]?.text || "ë¦¬ë”©ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
    document.getElementById("loadingOverlay").style.display = "none";
    showResult(text, true);
    saveHistory(text);

  } catch(err) {
    document.getElementById("loadingOverlay").style.display = "none";
    showResult(buildDemoReading(), false);
    saveHistory(buildDemoReading());
  }
}

function buildDemoReading() {
  const cards = drawnCards.filter(Boolean);
  const pos = POSITION_LABELS[selectedSpread];
  const lines = cards.map((c, i) =>
    `[${c.position}] ${c.name} ${c.reversed ? "(ì—­ë°©í–¥)" : "(ì •ë°©í–¥)"}\n${c.reversed ? "ì´ ì—ë„ˆì§€ê°€ ë‚´ë©´ì„ í–¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ë³´ë‹¤ ìì‹ ì˜ ë‚´ë©´ì„ ë¨¼ì € ì‚´í”¼ëŠ” ì‹œê°„ì´ í•„ìš”í•©ë‹ˆë‹¤." : "ê°•í•˜ê³  ê¸ì •ì ì¸ ì—ë„ˆì§€ê°€ íë¦…ë‹ˆë‹¤. ì´ ë°©í–¥ì„±ì„ ì‹ ë¢°í•˜ì‹­ì‹œì˜¤."}`
  ).join("\n\n");

  return `âœ¦ íƒ€ë¡œ108 ë°ëª¨ ë¦¬ë”© âœ¦\n\nì§€ê¸ˆ ë‹¹ì‹ ì´ ê°€ì ¸ì˜¨ ì§ˆë¬¸ â€” "${currentQuestion}" â€” ì´ ì§ˆë¬¸ ìì²´ê°€ ì´ë¯¸ ë³€í™”ì˜ ì²« ê±¸ìŒì…ë‹ˆë‹¤.\n\nì¹´ë“œë“¤ì€ ë‹¹ì‹ ì´ ì´ë¯¸ ë‹µì„ ì•Œê³  ìˆë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤. ë‘ë ¤ì›€ì´ ì•„ë‹Œ ì§ê´€ì„ ë”°ë¥´ì‹­ì‹œì˜¤. ìš°ì£¼ëŠ” ë‹¹ì‹ ì˜ ì§„ì‹¬ì— ì‘ë‹µí•˜ê³  ìˆìŠµë‹ˆë‹¤.\n\nâœ¦ í¬ì§€ì…˜ë³„ í•´ì„\n\n${lines}\n\n[ì¡°ì–¸] ì˜¤ëŠ˜ ì´ ìˆœê°„, ê°€ì¥ ì‘ê³  êµ¬ì²´ì ì¸ í•œ ê°€ì§€ í–‰ë™ì„ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤. ì™„ë²½í•œ ì¤€ë¹„ë¥¼ ê¸°ë‹¤ë¦¬ì§€ ë§ˆì„¸ìš”. ì¹´ë“œëŠ” ë‹¹ì‹ ì˜ ì²« ì›€ì§ì„ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.\n\nâ€» ì‹¤ì œ AI ë¦¬ë”©ì„ ë°›ìœ¼ë ¤ë©´ Claude API Keyë¥¼ ì„¤ì •í•´ ì£¼ì„¸ìš”.`;
}

function showResult(text, isReal) {
  document.getElementById("step-2").style.display = "none";
  document.getElementById("step-3").style.display = "block";

  // Summary cards
  document.getElementById("drawnCardsSummary").innerHTML =
    drawnCards.filter(Boolean).map(c => `
      <div class="summary-card">
        <div class="summary-card-emoji">${c.emoji}</div>
        <div class="summary-card-label">${c.position}</div>
        <div class="summary-card-name">${c.name}</div>
        ${c.reversed ? '<div class="summary-card-rev">ì—­ë°©í–¥</div>' : ''}
      </div>`).join("");

  // Parse advice
  let mainText = text;
  let adviceText = "";
  const m = text.match(/\[ì¡°ì–¸\]([\s\S]*?)$/);
  if (m) { mainText = text.slice(0, m.index).trim(); adviceText = m[1].trim(); }

  document.getElementById("readingContent").innerHTML = `
    <div class="reading-section fade-in">
      <h3>âŸ¡ ì¹´ë“œê°€ ì „í•˜ëŠ” ì´ì•¼ê¸° ${isReal ? "" : '<span style="font-size:10px;color:var(--text-dim)">(ë°ëª¨)</span>'}</h3>
      <div class="reading-text">${mainText}</div>
    </div>
    ${adviceText ? `
    <div class="reading-section fade-in fade-in-delay-1">
      <h3>âœ¦ ì§€ê¸ˆ ë‹¹ì¥ í•´ì•¼ í•  ê²ƒ</h3>
      <div class="advice-box">
        <h4>ì‹¤í–‰ ì¡°ì–¸</h4>
        <div class="advice-text">${adviceText}</div>
      </div>
    </div>` : ''}
    <div class="reading-section fade-in fade-in-delay-2">
      <h3>ğŸŒ™ ë§ˆìŠ¤í„° ë…¸íŠ¸</h3>
      <div class="expert-note">
        <div class="expert-avatar">ğŸ”®</div>
        <div>
          <div class="expert-name">íƒ€ë¡œ108 ë§ˆìŠ¤í„° Â· 30ë…„ ì‹¤ì „ ê²½ë ¥</div>
          <div class="expert-note-text">
            ì´ ì§ˆë¬¸ì„ ê°€ìŠ´ì— í’ˆê³  ì°¾ì•„ì˜¨ ë‹¹ì‹ ì˜ ìš©ê¸° ìì²´ê°€ ì´ë¯¸ ë³€í™”ì˜ ì‹œì‘ì…ë‹ˆë‹¤.
            ì¹´ë“œëŠ” ìš´ëª…ì„ ê³ ì •ì§“ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§€ê¸ˆ ì´ ìˆœê°„ ë‹¹ì‹ ì—ê²Œ í•„ìš”í•œ ë¹›ì„ ë¹„ì¶œ ë¿ì…ë‹ˆë‹¤.
            ë‹¹ì‹ ì˜ ì„ íƒì´ ê³§ ë‹¹ì‹ ì˜ ìš´ëª…ì…ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </div>`;

  window.scrollTo({ top: 0, behavior: "smooth" });
}

function saveHistory(text) {
  const record = {
    id: Date.now(),
    date: new Date().toLocaleDateString("ko-KR"),
    question: currentQuestion,
    cards: [...drawnCards],
    reading: text,
    spread: selectedSpread
  };
  history.unshift(record);
  if (history.length > 30) history.pop();
  try { localStorage.setItem("taro108_history", JSON.stringify(history)); } catch(e) {}
}

function restartReading() {
  drawnCards = [];
  currentQuestion = "";
  document.getElementById("questionInput").value = "";
  document.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));
  ["step-3","step-2"].forEach(id => document.getElementById(id).style.display = "none");
  document.getElementById("step-1").style.display = "block";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function shareReading() {
  const text = `ğŸ”® íƒ€ë¡œ108 ë¦¬ë”© ê²°ê³¼\n\nì§ˆë¬¸: ${currentQuestion}\nì¹´ë“œ: ${drawnCards.filter(Boolean).map(c=>c.name).join(", ")}\n\níƒ€ë¡œ108ì—ì„œ ë‹¹ì‹ ì˜ ì¹´ë“œë¥¼ ë½‘ì•„ë³´ì„¸ìš”!`;
  if (navigator.share) {
    navigator.share({ title: "íƒ€ë¡œ108", text });
  } else {
    navigator.clipboard.writeText(text).then(() => alert("âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
  }
}

// â”€â”€ History
function renderHistory() {
  const el = document.getElementById("historyList");
  if (!history.length) {
    el.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“œ</div><p>ì•„ì§ ìƒë‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ íƒ€ë¡œ ìƒë‹´ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p></div>`;
    return;
  }
  el.innerHTML = history.map(h => `
    <div class="history-item" onclick="viewHistory(${h.id})">
      <div class="history-date">${h.date}</div>
      <div class="history-question">${h.question}</div>
      <div class="history-cards">${(h.cards||[]).filter(Boolean).map(c=>c.emoji).join("")}</div>
    </div>`).join("");
}

function viewHistory(id) {
  const item = history.find(h => h.id == id);
  if (!item) return;
  currentQuestion = item.question;
  drawnCards = item.cards || [];
  selectedSpread = item.spread;

  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".nav-tab").forEach(t => t.classList.remove("active"));
  document.getElementById("screen-consult").classList.add("active");
  document.querySelectorAll(".nav-tab")[0].classList.add("active");
  ["step-1","step-2"].forEach(id => document.getElementById(id).style.display = "none");
  document.getElementById("step-3").style.display = "block";
  showResult(item.reading, true);
}
</script>
</body>
</html>
